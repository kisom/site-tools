#!/bin/sh
# .:[ rawk - rage against web frameworks ]:.
# 
# generates a static content from a tree of markdown files and other content
# originally written by 4096R/B7B720D6  "Kyle Isom <coder@kyleisom.net>"
# based on the suckless webframework (sw) by nibblesec
# 

CONF_FILE="rawkrc"
SRC_DIR="$1"


usage () {
    echo "usage: $0 <source dir>"
    exit 0
}

build_header () {

    HEADER=$(cat ${HDR_TPL} | sed -e 's/\$\{TITLE\}/$SITE_TITLE/ ; 
                                      s/\$\{SUBTITLE\}/$SITE_SUBTITLE')
}

build_submenu () {
    FC=""               # filter chain
    FILE_LIST=""

    for filter in $BL
    do
        FC="$FC | grep -v '$filter'"
    done

    FILE_LIST=$(eval ls -1 $SRC_DIR $FC | sort | xargs)
}

build_page () {
    # clear out vars
    HEADER=""
    SUBMENU=""
    PAGE=""
    BODY=""
    FOOTER=""


    build_header
    build_submenu
    PAGE="$HEADER$MENU"
    
    BODY=$($MDPARSER basename $1)
    PAGE="$PAGE$BODY"

    build_footer

    PAGE="$PAGE$FOOTER"

    echo $PAGE > 
    
}

# source config file and check valid targets and source dirs
. ./$CONF_FILE
if [ -z ${SRC_DIR} ]; then
    usage
fi

if [ -z ${TARGET} ]; then
    TARGET="$(pwd)/$(basename ${SRC_DIR}).build"
fi




build_submenu
cd ${TARGET}
find ./ -iname \*.md -type f -exec rm -f '{}' \;
